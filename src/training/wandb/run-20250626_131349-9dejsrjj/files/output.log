✅ Created open loop trainer for cyclic sequences
   🎯 Experiment: open_cyclic_20250626_131348
   🔁 Loop mode: open
   📊 Cycle penalty: 1.0
   🚀 Riemannian: True (geodesic)

🚀 Starting OPEN loop training on cyclic sequences
Loading cyclic sprites data from /scratch/alaforgu/longitudinal_experiments/RlVAE/data/processed/Sprites_train_cyclic.pt...
Cyclic sprites data shape: torch.Size([3000, 8, 3, 64, 64])
Data range: [0.000, 0.996]
✅ train cyclic dataset size: 10
✅ Final data shape: torch.Size([10, 8, 3, 64, 64])
✅ Final data range: [0.000, 0.996]
🔍 Verifying cyclicity of first 5 sequences:
   Seq 0: MSE = 0.00e+00
   Seq 1: MSE = 0.00e+00
   Seq 2: MSE = 0.00e+00
   Seq 3: MSE = 0.00e+00
   Seq 4: MSE = 0.00e+00
Loading cyclic sprites data from /scratch/alaforgu/longitudinal_experiments/RlVAE/data/processed/Sprites_train_cyclic.pt...
Cyclic sprites data shape: torch.Size([3000, 8, 3, 64, 64])
Data range: [0.000, 0.996]
✅ train cyclic dataset size: 5
✅ Final data shape: torch.Size([5, 8, 3, 64, 64])
✅ Final data range: [0.000, 0.996]
🔍 Verifying cyclicity of first 5 sequences:
   Seq 0: MSE = 0.00e+00
   Seq 1: MSE = 0.00e+00
   Seq 2: MSE = 0.00e+00
   Seq 3: MSE = 0.00e+00
   Seq 4: MSE = 0.00e+00

📈 Epoch 1/1 - OPEN Mode
 ... (more hidden) ...
🧠 USING RIEMANNIAN METRIC-AWARE POSTERIOR (batch_size=2)
🧠 Creating sequence trajectory visualization for epoch 0
🎬 Creating comprehensive reconstruction visualization for epoch 0
🔬 Creating manifold visualizations for epoch 0
📊 Analyzing 2 sequences with 8 timesteps
📍 Computing metrics for timestep 1/8 using flow-evolved coordinates
   Computing G(z) at 100 flow-evolved points...
   ✅ Computed metrics: det(G⁻¹) range [4.02e-26, 5.66e-09]
   ✅ Timestep 0 data collected (metrics: 7 properties)
📍 Computing metrics for timestep 2/8 using flow-evolved coordinates
   Computing G(z) at 100 flow-evolved points...
   ✅ Computed metrics: det(G⁻¹) range [1.06e-27, 6.18e-11]
   ✅ Timestep 1 data collected (metrics: 7 properties)
📍 Computing metrics for timestep 3/8 using flow-evolved coordinates
   Computing G(z) at 100 flow-evolved points...
   ✅ Computed metrics: det(G⁻¹) range [1.95e-29, 5.93e-12]
   ✅ Timestep 2 data collected (metrics: 7 properties)
📍 Computing metrics for timestep 4/8 using flow-evolved coordinates
   Computing G(z) at 100 flow-evolved points...
   ✅ Computed metrics: det(G⁻¹) range [5.63e-30, 8.47e-12]
   ✅ Timestep 3 data collected (metrics: 7 properties)
📍 Computing metrics for timestep 5/8 using flow-evolved coordinates
   Computing G(z) at 100 flow-evolved points...
   ✅ Computed metrics: det(G⁻¹) range [3.48e-30, 1.87e-12]
   ✅ Timestep 4 data collected (metrics: 7 properties)
📍 Computing metrics for timestep 6/8 using flow-evolved coordinates
   Computing G(z) at 100 flow-evolved points...
   ✅ Computed metrics: det(G⁻¹) range [9.03e-30, 2.57e-10]
   ✅ Timestep 5 data collected (metrics: 7 properties)
📍 Computing metrics for timestep 7/8 using flow-evolved coordinates
   Computing G(z) at 100 flow-evolved points...
   ✅ Computed metrics: det(G⁻¹) range [5.54e-29, 1.76e-10]
   ✅ Timestep 6 data collected (metrics: 7 properties)
📍 Computing metrics for timestep 8/8 using flow-evolved coordinates
   Computing G(z) at 100 flow-evolved points...
   ✅ Computed metrics: det(G⁻¹) range [3.78e-30, 1.66e-11]
   ✅ Timestep 7 data collected (metrics: 7 properties)
🎨 Creating visualizations with metrics for 8 timesteps...
📈 Creating enhanced PCA analysis with flow-evolved coordinates...
✅ Enhanced PCA analysis created: 8/8 timesteps have metrics
🔥 Creating enhanced manifold heatmaps with flow-evolved coordinates...
✅ Enhanced manifold heatmaps created
⏱️ Creating temporal metric analysis...
✅ Temporal metric analysis created: 8/8 timesteps analyzed
✨ Manifold visualizations complete for epoch 0
🌍 Creating enhanced geodesic & metric impact visualizations for epoch 0
🌍 Creating INTERACTIVE geodesic slider visualization with timestep evolution...
📊 Computing DYNAMIC geodesic background fields for each timestep...
   Computing background fields for timestep 0...
     ✅ Geodesic background computed for t=0: det(G) range [7.58e+00, 3.00e+02]
   Computing background fields for timestep 1...
     🔄 Applying 1 forward flow steps to geodesic grid...
       Applying flow 0: z_0 → z_1
     ✅ Geodesic grid transformed to timestep 1 coordinate system
     ✅ Geodesic background computed for t=1: det(G) range [9.56e+00, 3.76e+02]
   Computing background fields for timestep 2...
     🔄 Applying 2 forward flow steps to geodesic grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
     ✅ Geodesic grid transformed to timestep 2 coordinate system
     ✅ Geodesic background computed for t=2: det(G) range [1.88e+01, 6.64e+02]
   Computing background fields for timestep 3...
     🔄 Applying 3 forward flow steps to geodesic grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
       Applying flow 2: z_2 → z_3
     ✅ Geodesic grid transformed to timestep 3 coordinate system
     ✅ Geodesic background computed for t=3: det(G) range [1.67e+01, 1.20e+03]
   Computing background fields for timestep 4...
     🔄 Applying 4 forward flow steps to geodesic grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
       Applying flow 2: z_2 → z_3
       Applying flow 3: z_3 → z_4
     ✅ Geodesic grid transformed to timestep 4 coordinate system
     ✅ Geodesic background computed for t=4: det(G) range [1.50e+01, 1.34e+03]
   Computing background fields for timestep 5...
     🔄 Applying 5 forward flow steps to geodesic grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
       Applying flow 2: z_2 → z_3
       Applying flow 3: z_3 → z_4
       Applying flow 4: z_4 → z_5
     ✅ Geodesic grid transformed to timestep 5 coordinate system
     ✅ Geodesic background computed for t=5: det(G) range [8.87e+00, 1.32e+03]
   Computing background fields for timestep 6...
     🔄 Applying 6 forward flow steps to geodesic grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
       Applying flow 2: z_2 → z_3
       Applying flow 3: z_3 → z_4
       Applying flow 4: z_4 → z_5
       Applying flow 5: z_5 → z_6
     ✅ Geodesic grid transformed to timestep 6 coordinate system
     ✅ Geodesic background computed for t=6: det(G) range [6.55e+00, 9.05e+02]
   Computing background fields for timestep 7...
     🔄 Applying 7 forward flow steps to geodesic grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
       Applying flow 2: z_2 → z_3
       Applying flow 3: z_3 → z_4
       Applying flow 4: z_4 → z_5
       Applying flow 5: z_5 → z_6
       Applying flow 6: z_6 → z_7
     ✅ Geodesic grid transformed to timestep 7 coordinate system
     ✅ Geodesic background computed for t=7: det(G) range [9.89e+00, 1.47e+03]
    ✅ Geodesic slider: Using FLOW-EVOLVED coordinates for timestep 0
    ✅ Geodesic slider: Using FLOW-EVOLVED coordinates for timestep 1
    ✅ Geodesic slider: Using FLOW-EVOLVED coordinates for timestep 2
    ✅ Geodesic slider: Using FLOW-EVOLVED coordinates for timestep 3
    ✅ Geodesic slider: Using FLOW-EVOLVED coordinates for timestep 4
    ✅ Geodesic slider: Using FLOW-EVOLVED coordinates for timestep 5
    ✅ Geodesic slider: Using FLOW-EVOLVED coordinates for timestep 6
    ✅ Geodesic slider: Using FLOW-EVOLVED coordinates for timestep 7
   📊 Geodesic frame 0: using det_G background range [7.58e+00, 3.00e+02]
   📊 Geodesic frame 1: using det_G background range [9.56e+00, 3.76e+02]
   📊 Geodesic frame 2: using det_G background range [1.88e+01, 6.64e+02]
   📊 Geodesic frame 3: using det_G background range [1.67e+01, 1.20e+03]
   📊 Geodesic frame 4: using det_G background range [1.50e+01, 1.34e+03]
   📊 Geodesic frame 5: using det_G background range [8.87e+00, 1.32e+03]
   📊 Geodesic frame 6: using det_G background range [6.55e+00, 9.05e+02]
   📊 Geodesic frame 7: using det_G background range [9.89e+00, 1.47e+03]
/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/kaleido/__init__.py:14: UserWarning:



Warning: You have Plotly version 5.24.1, which is not compatible with this version of Kaleido (1.0.0).

This means that static image generation (e.g. `fig.write_image()`) will not work.

Please upgrade Plotly to version 6.1.1 or greater, or downgrade Kaleido to version 0.2.1.
⚠️ Interactive geodesic slider visualization failed:
Image export using the "kaleido" engine requires the kaleido package,
which can be installed using pip:
    $ pip install -U kaleido


Traceback (most recent call last):
  File "/scratch/alaforgu/longitudinal_experiments/RlVAE/src/training/train_cyclic_loop_comparison.py", line 3064, in _create_interactive_geodesic_slider_visualization
    fig.write_image(png_filename, width=1600, height=1000, scale=2)
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/basedatatypes.py", line 3835, in write_image
    return pio.write_image(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/io/_kaleido.py", line 266, in write_image
    img_data = to_image(
               ^^^^^^^^^
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/io/_kaleido.py", line 132, in to_image
    raise ValueError(
ValueError:
Image export using the "kaleido" engine requires the kaleido package,
which can be installed using pip:
    $ pip install -U kaleido

✅ Enhanced geodesic visualization created for epoch 0
✨ Creating FANCY interactive geodesic visualizations...
✨ Creating FANCY interactive geodesic visualizations for epoch 0
⚠️ Fancy visualization failed:
Image export using the "kaleido" engine requires the kaleido package,
which can be installed using pip:
    $ pip install -U kaleido

Traceback (most recent call last):
  File "/scratch/alaforgu/longitudinal_experiments/RlVAE/src/training/train_cyclic_loop_comparison.py", line 3663, in create_fancy_interactive_geodesic_visualizations
    fig.write_image(png_filename, width=1600, height=1000, scale=2)
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/basedatatypes.py", line 3835, in write_image
    return pio.write_image(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/io/_kaleido.py", line 266, in write_image
    img_data = to_image(
               ^^^^^^^^^
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/io/_kaleido.py", line 132, in to_image
    raise ValueError(
ValueError:
Image export using the "kaleido" engine requires the kaleido package,
which can be installed using pip:
    $ pip install -U kaleido

🎬 Creating TEMPORAL metric evolution visualization...
🌊 Creating FLOW-BASED temporal metric evolution visualization for epoch 0
🌊 Computing flow-based det(G) evolution for 2 sequences with 8 timesteps
📍 Computing base metric det(G(z_i0))...
   Base det(G) range: [1.024e+07, 4.231e+10]
🌊 Propagating det(G) through flow chain...
   Flow step 1: z_0 → z_1
     |J_flow_1| range: [1.149, 1.199]
     det(G) range: [1.176e+07, 5.072e+10]
   Flow step 2: z_1 → z_2
     |J_flow_2| range: [1.204, 1.228]
     det(G) range: [1.444e+07, 6.106e+10]
   Flow step 3: z_2 → z_3
     |J_flow_3| range: [0.942, 0.950]
     det(G) range: [1.373e+07, 5.749e+10]
   Flow step 4: z_3 → z_4
     |J_flow_4| range: [0.940, 0.951]
     det(G) range: [1.306e+07, 5.403e+10]
   Flow step 5: z_4 → z_5
     |J_flow_5| range: [0.858, 0.879]
     det(G) range: [1.120e+07, 4.748e+10]
   Flow step 6: z_5 → z_6
     |J_flow_6| range: [1.255, 1.272]
     det(G) range: [1.406e+07, 6.040e+10]
   Flow step 7: z_6 → z_7
     |J_flow_7| range: [1.152, 1.152]
     det(G) range: [1.620e+07, 6.958e+10]
✅ Flow-based evolution complete!
   Final det(G) range: [1.024e+07, 6.958e+10]
   Det(G) amplification: 1.644x
📊 PCA projection complete (explained variance: 97.8%)
🔥 Computing spatial det(G) heatmaps for each timestep...
   Computing spatial heatmap for timestep 0...
   Computing spatial heatmap for timestep 1...
     ✅ Computed heatmap for t=1: det(G) range [2.34e+08, 7.66e+25]
   Computing spatial heatmap for timestep 2...
     ✅ Computed heatmap for t=2: det(G) range [3.05e+10, 1.41e+27]
   Computing spatial heatmap for timestep 3...
     ✅ Computed heatmap for t=3: det(G) range [1.54e+10, 1.79e+28]
   Computing spatial heatmap for timestep 4...
     ✅ Computed heatmap for t=4: det(G) range [5.12e+09, 5.45e+28]
   Computing spatial heatmap for timestep 5...
     ✅ Computed heatmap for t=5: det(G) range [1.21e+08, 6.00e+28]
   Computing spatial heatmap for timestep 6...
     ✅ Computed heatmap for t=6: det(G) range [1.00e+07, 7.41e+27]
   Computing spatial heatmap for timestep 7...
     ✅ Computed heatmap for t=7: det(G) range [5.19e+08, 2.35e+29]
✅ Computed 8 spatial heatmaps with evolving det(G) fields!
⚠️ Flow-based interactive animation failed:
Image export using the "kaleido" engine requires the kaleido package,
which can be installed using pip:
    $ pip install -U kaleido

Traceback (most recent call last):
  File "/scratch/alaforgu/longitudinal_experiments/RlVAE/src/training/train_cyclic_loop_comparison.py", line 5237, in _create_flow_based_interactive_animation
    fig.write_image(png_filename, width=1600, height=900, scale=2)
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/basedatatypes.py", line 3835, in write_image
    return pio.write_image(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/io/_kaleido.py", line 266, in write_image
    img_data = to_image(
               ^^^^^^^^^
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/io/_kaleido.py", line 132, in to_image
    raise ValueError(
ValueError:
Image export using the "kaleido" engine requires the kaleido package,
which can be installed using pip:
    $ pip install -U kaleido

⚠️ Interactive temporal animation failed:
Image export using the "kaleido" engine requires the kaleido package,
which can be installed using pip:
    $ pip install -U kaleido

Traceback (most recent call last):
  File "/scratch/alaforgu/longitudinal_experiments/RlVAE/src/training/train_cyclic_loop_comparison.py", line 5580, in _create_interactive_temporal_animation
    fig.write_image(png_filename, width=1600, height=800, scale=2)
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/basedatatypes.py", line 3835, in write_image
    return pio.write_image(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/io/_kaleido.py", line 266, in write_image
    img_data = to_image(
               ^^^^^^^^^
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/io/_kaleido.py", line 132, in to_image
    raise ValueError(
ValueError:
Image export using the "kaleido" engine requires the kaleido package,
which can be installed using pip:
    $ pip install -U kaleido

✨ Flow-based temporal metric evolution visualization created for epoch 0!
🔥 Creating moderate-detail heatmaps...
🌟 Creating MODERATE-DETAIL metric heatmap for epoch 0
📊 Computing metrics on 10000 moderate-resolution grid points...
🎬 Creating INTERACTIVE metric slider visualization with timestep evolution...
🔄 Computing metric fields for timesteps 0 to 7...
📊 Computing DYNAMIC metric heatmaps for each timestep...
   Computing heatmap for timestep 0...
     ✅ Heatmap computed for t=0: det(G) range [1.60e+09, 7.73e+27]
   Computing heatmap for timestep 1...
     🔄 Applying 1 forward flow steps to grid...
       Applying flow 0: z_0 → z_1
     ✅ Grid transformed to timestep 1 coordinate system
     ✅ Heatmap computed for t=1: det(G) range [1.48e+10, 4.43e+28]
   Computing heatmap for timestep 2...
     🔄 Applying 2 forward flow steps to grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
     ✅ Grid transformed to timestep 2 coordinate system
     ✅ Heatmap computed for t=2: det(G) range [6.47e+11, 9.17e+29]
   Computing heatmap for timestep 3...
     🔄 Applying 3 forward flow steps to grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
       Applying flow 2: z_2 → z_3
     ✅ Grid transformed to timestep 3 coordinate system
     ✅ Heatmap computed for t=3: det(G) range [3.81e+11, 1.43e+30]
   Computing heatmap for timestep 4...
     🔄 Applying 4 forward flow steps to grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
       Applying flow 2: z_2 → z_3
       Applying flow 3: z_3 → z_4
     ✅ Grid transformed to timestep 4 coordinate system
     ✅ Heatmap computed for t=4: det(G) range [4.05e+10, 1.98e+30]
   Computing heatmap for timestep 5...
     🔄 Applying 5 forward flow steps to grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
       Applying flow 2: z_2 → z_3
       Applying flow 3: z_3 → z_4
       Applying flow 4: z_4 → z_5
     ✅ Grid transformed to timestep 5 coordinate system
     ✅ Heatmap computed for t=5: det(G) range [6.73e+09, 4.55e+29]
   Computing heatmap for timestep 6...
     🔄 Applying 6 forward flow steps to grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
       Applying flow 2: z_2 → z_3
       Applying flow 3: z_3 → z_4
       Applying flow 4: z_4 → z_5
       Applying flow 5: z_5 → z_6
     ✅ Grid transformed to timestep 6 coordinate system
     ✅ Heatmap computed for t=6: det(G) range [9.67e+08, 9.57e+28]
   Computing heatmap for timestep 7...
     🔄 Applying 7 forward flow steps to grid...
       Applying flow 0: z_0 → z_1
       Applying flow 1: z_1 → z_2
       Applying flow 2: z_2 → z_3
       Applying flow 3: z_3 → z_4
       Applying flow 4: z_4 → z_5
       Applying flow 5: z_5 → z_6
       Applying flow 6: z_6 → z_7
     ✅ Grid transformed to timestep 7 coordinate system
     ✅ Heatmap computed for t=7: det(G) range [2.87e+10, 4.78e+30]

/scratch/alaforgu/longitudinal_experiments/RlVAE/src/training/train_cyclic_loop_comparison.py:879: UserWarning:

To copy construct from a tensor, it is recommended to use sourceTensor.detach().clone() or sourceTensor.detach().clone().requires_grad_(True), rather than torch.tensor(sourceTensor).
    ✅ Using FLOW-EVOLVED coordinates for timestep 0
    ✅ Using FLOW-EVOLVED coordinates for timestep 1
    ✅ Using FLOW-EVOLVED coordinates for timestep 2
    ✅ Using FLOW-EVOLVED coordinates for timestep 3
    ✅ Using FLOW-EVOLVED coordinates for timestep 4
    ✅ Using FLOW-EVOLVED coordinates for timestep 5
    ✅ Using FLOW-EVOLVED coordinates for timestep 6
    ✅ Using FLOW-EVOLVED coordinates for timestep 7
   📊 Frame 0: using det_heatmap range [1.60e+09, 7.73e+27]
   📊 Frame 1: using det_heatmap range [1.48e+10, 4.43e+28]
   📊 Frame 2: using det_heatmap range [6.47e+11, 9.17e+29]
   📊 Frame 3: using det_heatmap range [3.81e+11, 1.43e+30]
   📊 Frame 4: using det_heatmap range [4.05e+10, 1.98e+30]
   📊 Frame 5: using det_heatmap range [6.73e+09, 4.55e+29]
   📊 Frame 6: using det_heatmap range [9.67e+08, 9.57e+28]
   📊 Frame 7: using det_heatmap range [2.87e+10, 4.78e+30]
⚠️ Interactive metric slider visualization failed:
Image export using the "kaleido" engine requires the kaleido package,
which can be installed using pip:
    $ pip install -U kaleido

Traceback (most recent call last):
  File "/scratch/alaforgu/longitudinal_experiments/RlVAE/src/training/train_cyclic_loop_comparison.py", line 1156, in _create_interactive_metric_slider_visualization
    fig.write_image(png_filename, width=1600, height=1000, scale=2)
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/basedatatypes.py", line 3835, in write_image
    return pio.write_image(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/io/_kaleido.py", line 266, in write_image
    img_data = to_image(
               ^^^^^^^^^
  File "/scratch/alaforgu/miniconda3/lib/python3.12/site-packages/plotly/io/_kaleido.py", line 132, in to_image
    raise ValueError(
ValueError:
Image export using the "kaleido" engine requires the kaleido package,
which can be installed using pip:
    $ pip install -U kaleido

✅ Moderate detail metric heatmap created with 10000 points
✅ Epoch 0: Train Loss: 7509.3058, Val Loss: 2742.5610, Cycle: 0.0000
💾 Saved best open model (val_loss: 2742.5610)

🎉 OPEN training completed!

⏭️ Skipping final curvature analysis (disabled by --disable_curvature_during_training)
